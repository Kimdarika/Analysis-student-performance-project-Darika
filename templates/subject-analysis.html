<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ“˜ Subject Analysis | Student Analyzer</title>
<link rel="stylesheet" href="/static/css/navbar.css">
<link rel="stylesheet" href="/static/css/footer.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { transition: 0.3s; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
h2,h5{ font-weight:600; }
.card{ border-radius:15px; transition:0.3s; box-shadow:0 5px 20px rgba(0,0,0,0.05);}
.card:hover{ transform:translateY(-3px); box-shadow:0 8px 25px rgba(0,0,0,0.15);}
.highlight-best{ background-color:#d4edda !important;}
.highlight-worst{ background-color:#f8d7da !important;}
.table-responsive{ overflow-x:auto; width:100%;}
#studentTable{ width:100%; min-width:1400px;}
#studentTable th,#studentTable td{ white-space:nowrap; vertical-align:middle;}
#studentTable th{ background-color:#0d6efd !important; color:#fff !important; position:sticky; top:0; z-index:10;}
#studentTable tbody tr:hover{ background-color: rgba(13,110,253,0.1); transition:0.3s;}
.table-striped > tbody > tr:nth-of-type(odd){ background-color: rgba(0,0,0,0.03);}
input,select{ box-shadow:0 1px 3px rgba(0,0,0,0.1); transition:0.3s;}
input:focus,select:focus{ box-shadow:0 3px 6px rgba(13,110,253,0.2); border-color:#0d6efd;}
.btn{ transition:0.3s;}
.btn:hover{ transform:translateY(-2px);}
@media(max-width:768px){ #studentTable{ min-width:1000px;} .card{ margin-bottom:20px; } }

</style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
<div class="container-fluid">
<a class="navbar-brand fw-bold" href="index.html">Student Analyzer</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarNav">
<ul class="navbar-nav ms-auto">
<li class="nav-item"><a class="nav-link active" aria-current="page" href="/dashboard">ğŸ  Dashboard</a></li>
<li class="nav-item"><a class="nav-link" href="/student-profile">ğŸ‘©â€ğŸ“ Student Management</a></li>
<li class="nav-item"><a class="nav-link" href="/subject-analysis">ğŸ“˜ Subject Analysis</a></li>
<li class="nav-item"><a class="nav-link" href="/comparison">ğŸ“ˆ Comparison</a></li>
<li class="nav-item"><a class="nav-link" href="/prediction">ğŸ§® Prediction</a></li>
<li class="nav-item"><a class="nav-link" href="/reports">ğŸ“Š Reports</a></li>
<li class="nav-item"><a class="nav-link" href="/teacher-insights">ğŸ§‘â€ğŸ« Teacher Insights</a></li>
<li class="nav-item"><a class="nav-link" href="/trends">ğŸ—“ï¸ Trend</a></li>
</ul>
</div>
</div>
</nav>

<div class="container-fluid mt-5">
<h2 class="text-center text-primary mb-4">ğŸ“Š Two-Term Student Performance Analysis</h2>

<!-- Input Form -->
<div class="card p-4 shadow-sm mb-4">
<h5 class="mb-3 text-secondary"><i class="bi bi-pencil-square"></i> Add or Update Student Scores</h5>
<div class="row g-3 mb-3">
<div class="col-md-3"><input type="text" id="name" class="form-control" placeholder="Student Name" /></div>
<div class="col-md-3">
<select id="term" class="form-select">
<option value="term1">Term 1</option>
<option value="term2">Term 2</option>
</select>
</div>
</div>

<!-- Term 1 Subjects -->
<div id="term1-subjects" class="row g-2">
<div class="col-md-2"><input type="number" class="form-control" id="bcu" placeholder="BCU" min="0" max="100" /></div>
<div class="col-md-2"><input type="number" class="form-control" id="englishIT1" placeholder="English IT" min="0" max="100" /></div>
<div class="col-md-2"><input type="number" class="form-control" id="general1" placeholder="General English" min="0" max="100" /></div>
<div class="col-md-2"><input type="number" class="form-control" id="logic" placeholder="Logic" min="0" max="100" /></div>
<div class="col-md-2"><input type="number" class="form-control" id="pl1" placeholder="PL" min="0" max="100" /></div>
<div class="col-md-2"><input type="number" class="form-control" id="design" placeholder="Design" min="0" max="100" /></div>
</div>

<!-- Term 2 Subjects -->
<div id="term2-subjects" class="row g-2 mt-2" style="display:none;">
<div class="col-md-2"><input type="number" class="form-control" id="englishIT2" placeholder="English IT" min="0" max="100" /></div>
<div class="col-md-2"><input type="number" class="form-control" id="general2" placeholder="General English" min="0" max="100" /></div>
<div class="col-md-2"><input type="number" class="form-control" id="algorithm" placeholder="Algorithm" min="0" max="100" /></div>
<div class="col-md-2"><input type="number" class="form-control" id="pl2" placeholder="PL" min="0" max="100" /></div>
<div class="col-md-2"><input type="number" class="form-control" id="webDesign" placeholder="Web Design" min="0" max="100" /></div>
</div>

<div class="mt-3 text-end">
<button id="addBtn" class="btn btn-primary">ğŸ’¾ Add / Update</button>
<button id="clearAllBtn" class="btn btn-danger">ğŸ§¹ Clear All</button>
</div>
</div>

<!-- Search + Export -->
<div class="d-flex justify-content-between align-items-center mb-3">
<input type="text" id="searchInput" class="form-control w-50 shadow-sm" placeholder="ğŸ” Search student..." />
<button id="exportBtn" class="btn btn-success shadow-sm">â¬‡ï¸ Export CSV</button>
</div>

<!-- Table -->
<div class="card shadow-sm mb-4">
<div class="card-body">
<h5 class="text-secondary mb-3">ğŸ“‹ Student Records</h5>
<div class="table-responsive">
<table class="table table-bordered text-center align-middle table-striped table-hover" id="studentTable">
<thead class="table-primary sticky-top">
<tr>
<th>#</th>
<th>Name</th>
<th>Class</th>
<th>BCU</th>
<th>English IT (T1)</th>
<th>General English (T1)</th>
<th>Logic</th>
<th>PL (T1)</th>
<th>Design</th>
<th>Total (T1)</th>
<th>Average (T1)</th>
<th>English IT (T2)</th>
<th>General English (T2)</th>
<th>Algorithm</th>
<th>PL (T2)</th>
<th>Web Design</th>
<th>Total (T2)</th>
<th>Average (T2)</th>
<th>Action</th>
<th>Timestamp</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
</div>

<!-- Best/Worst -->
<div class="text-center mb-4">
<h5 id="best" class="text-success fw-bold"></h5>
<h5 id="worst" class="text-danger fw-bold"></h5>
</div>

<!-- Chart Modal -->
<div class="modal fade" id="scoreModal" tabindex="-1" aria-labelledby="scoreModalLabel" aria-hidden="true">
<div class="modal-dialog modal-lg modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="scoreModalLabel">Student Score Chart</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
<canvas id="scoreChart" height="150"></canvas>
</div>
</div>
</div>
</div>

</div> <!-- container-fluid -->

<footer>
<p>Â© 2025 Student Analyzer. All Rights Reserved.</p>
<p><a href="index.html">Home</a> | <a href="reports.html">Reports</a> | <a href="contact.html">Contact</a></p>
<p class="social-icons"><a href="#" title="Facebook">ğŸ“˜</a><a href="#" title="Twitter">ğŸ¦</a><a href="#" title="LinkedIn">ğŸ’¼</a></p>
<p>Made with â¤ï¸ by the Student Analyzer Team</p>
</footer>

<script>
// ==================== JS ====================
const studentNames = [
    "PANHA KOEUN","SOPHEA SOPHORN","PISET NEA","SOPHY MOEURN","LIHEANG HENG","PHALLA SUONG",
    "PHOUN PHAN","RATHANA SOKHA","THALITA SOK","BOREY PENH","RINA HO","CHANTHEA CHHEA",
    "MAKARA PINN","VICHEKA HAV","SEYHA NY","CHANNY VEN","VICHEKA SOENG","SAMART LUCH",
    "REAM KHORN","KOEMSEANG PHOEURN","DANE MIOK","VA KHIM KREAN","SAN SVIT","MOLIKA LON",
    "SOKSEYLA SEN","REACH TALAB","CHHITCHHANUT NANG","SOKKHOEURN LENG","CHANTREA HAN",
    "SREYDOEURN KEO","SREYDETH KHON","NARITH HEN","SREYPOV HUT","VICHET SAT","SOTHIN KE",
    "REAKSMEY SAN","DARIKA KIM","SIEVMEY VAN","SINAT LEK","MAKARA PON","LITA SOK",
    "VISA SAK","PILIP YOM","SAVIN PHUONG","SEREY PHEM","MESARIN M","NITACHHROUN F",
    "SATANBUNTIT M","VANNALEN M","SREYKEOKEUN F","CHANSAYHAHOEURN M","KRAVANNYOR M",
    "TOLATIM M","SOPHATS IENG M","SREYVIKVON F","SOPHEAPHAL F","KINGVOEUN M",
    "CHAMROEUNSONG M","KHOUEN M","SIVSANN M","SREYROTHSANG F","LYSARL M","CHANDYSRIN F",
    "SREYLEAKSEMF F","SOKKEANGYEANG F","SREYMOMPO F","MESARIN M","ROEURNROS M",
    "SAMNANGSIM M","SOKNYNIM M","RANITREN F","CHANTHYCHET F","YAPHORN M","KUNTHEAYON F",
    "SOKYANGLAKK F","MARYSAO F","DARINHILT HAM M"
];
let students = [];
studentNames.forEach((name, idx)=>{
    const term1Scores = Array.from({length:6},()=>Math.floor(Math.random()*41+60));
    const term2Scores = Array.from({length:5},()=>Math.floor(Math.random()*41+60));
    const studentClass = idx<26?'A':idx<52?'B':'C';
    students.push(
        {name, term:'term1', class:studentClass, scores:term1Scores, total:term1Scores.reduce((a,b)=>a+b,0), average:(term1Scores.reduce((a,b)=>a+b)/6).toFixed(2), created: new Date().toLocaleString()},
        {name, term:'term2', class:studentClass, scores:term2Scores, total:term2Scores.reduce((a,b)=>a+b,0), average:(term2Scores.reduce((a,b)=>a+b)/5).toFixed(2), created: new Date().toLocaleString()}
    );
});

let chartInstance = null;

function render(filter=""){
    const tbody = document.querySelector("#studentTable tbody");
    tbody.innerHTML = "";
    studentNames.forEach((name, idx)=>{
        if(filter && !name.toLowerCase().includes(filter.toLowerCase())) return;
        const t1 = students.find(s=>s.name===name && s.term==='term1');
        const t2 = students.find(s=>s.name===name && s.term==='term2');
        tbody.innerHTML += `<tr>
            <td>${idx+1}</td>
            <td>${name}</td>
            <td>${t1?.class || t2?.class || ""}</td>
            ${t1? t1.scores.map(s=>`<td>${s}</td>`).join('')+`<td>${t1.total}</td><td>${t1.average}</td>`:'<td colspan="6"></td>'}
            ${t2? t2.scores.map(s=>`<td>${s}</td>`).join('')+`<td>${t2.total}</td><td>${t2.average}</td>`:'<td colspan="5"></td>'}
            <td>
                <button class="btn btn-sm btn-info" onclick="viewChart('${name}')">ğŸ“Š View</button>
                <button class="btn btn-sm btn-warning" onclick="editStudent('${name}')">âœï¸ Edit</button>
                <button class="btn btn-sm btn-danger" onclick="deleteStudent('${name}')">ğŸ—‘ Delete</button>
            </td>
            <td>${t1?.created || t2?.created || ''}</td>
        </tr>`;
    });
    showBestWorst();
}

function viewChart(name){
    const t1 = students.find(s=>s.name===name && s.term==='term1');
    const t2 = students.find(s=>s.name===name && s.term==='term2');
    const labels = [];
    const dataT1 = [];
    const dataT2 = [];
    if(t1){ labels.push("BCU","English IT","General English","Logic","PL","Design"); dataT1.push(...t1.scores);}
    if(t2){ labels.push("English IT","General English","Algorithm","PL","Web Design"); dataT2.push(...t2.scores);}
    const datasets = [];
    if(dataT1.length){ datasets.push({label:'Term 1', data:dataT1, backgroundColor:'rgba(54,162,235,0.6)', borderColor:'rgba(54,162,235,1)', borderWidth:1}); }
    if(dataT2.length){ datasets.push({label:'Term 2', data:dataT2, backgroundColor:'rgba(255,99,132,0.6)', borderColor:'rgba(255,99,132,1)', borderWidth:1}); }
    if(chartInstance) chartInstance.destroy();
    const ctx = document.getElementById('scoreChart').getContext('2d');
    chartInstance = new Chart(ctx,{type:'bar', data:{labels, datasets}, options:{responsive:true, plugins:{title:{display:true,text:`Scores of ${name}`}, legend:{position:'top'}}, scales:{y:{beginAtZero:true,max:100}}}});
    new bootstrap.Modal(document.getElementById('scoreModal')).show();
}

function editStudent(name){
    const t1 = students.find(s=>s.name===name && s.term==='term1');
    const t2 = students.find(s=>s.name===name && s.term==='term2');
    document.getElementById('name').value = name;
    document.getElementById('term').value = t1?'term1':'term2';
    toggleTermFields();
    if(t1){ ['bcu','englishIT1','general1','logic','pl1','design'].forEach((id,i)=> document.getElementById(id).value = t1.scores[i]); }
    if(t2){ ['englishIT2','general2','algorithm','pl2','webDesign'].forEach((id,i)=> document.getElementById(id).value = t2.scores[i]); }
}

function deleteStudent(name){
    if(!confirm(`Are you sure to delete ${name}?`)) return;
    students = students.filter(s=>s.name!==name);
    render();
}

document.getElementById('addBtn').addEventListener('click',()=>{
    const name = document.getElementById('name').value.trim();
    const term = document.getElementById('term').value;
    if(!name){ alert("Please enter student name!"); return; }
    const scores = term==='term1' ? [
        +document.getElementById('bcu').value,
        +document.getElementById('englishIT1').value,
        +document.getElementById('general1').value,
        +document.getElementById('logic').value,
        +document.getElementById('pl1').value,
        +document.getElementById('design').value
    ] : [
        +document.getElementById('englishIT2').value,
        +document.getElementById('general2').value,
        +document.getElementById('algorithm').value,
        +document.getElementById('pl2').value,
        +document.getElementById('webDesign').value
    ];
    const total = scores.reduce((a,b)=>a+b,0);
    const avg = (total/scores.length).toFixed(2);
    const existingIndex = students.findIndex(s=>s.name===name && s.term===term);
    if(existingIndex>-1){
        students[existingIndex].scores = scores;
        students[existingIndex].total = total;
        students[existingIndex].average = avg;
        students[existingIndex].created = new Date().toLocaleString();
    } else {
        const studentClass = studentNames.indexOf(name)<26?'A':studentNames.indexOf(name)<52?'B':'C';
        students.push({name, term, class:studentClass, scores, total, average:avg, created:new Date().toLocaleString()});
    }
    render();
    document.getElementById('name').value = "";
});

document.getElementById('clearAllBtn').addEventListener('click',()=>{
    if(!confirm("Are you sure you want to clear all students?")) return;
    students = [];
    render();
});

document.getElementById('searchInput').addEventListener('input',(e)=>{
    render(e.target.value);
});

document.getElementById('exportBtn').addEventListener('click',()=>{
    let csv = "Name,Term,Class,Scores,Total,Average,Timestamp\n";
    students.forEach(s=>{
        csv += `${s.name},${s.term},${s.class},"${s.scores.join('|')}",${s.total},${s.average},${s.created}\n`;
    });
    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "students.csv";
    a.click();
    URL.revokeObjectURL(url);
});

document.getElementById('term').addEventListener('change', toggleTermFields);
function toggleTermFields(){
    const term = document.getElementById('term').value;
    document.getElementById('term1-subjects').style.display = term==='term1'?'flex':'none';
    document.getElementById('term2-subjects').style.display = term==='term2'?'flex':'none';
}

function showBestWorst(){
    if(students.length === 0) {
        document.getElementById('best').textContent = "";
        document.getElementById('worst').textContent = "";
        return;
    }
    const averages = studentNames.map(name=>{
        const t1 = students.find(s=>s.name===name && s.term==='term1');
        const t2 = students.find(s=>s.name===name && s.term==='term2');
        const avg1 = t1?parseFloat(t1.average):0;
        const avg2 = t2?parseFloat(t2.average):0;
        return {name, avg: ((avg1+avg2)/2).toFixed(2)};
    });
    averages.sort((a,b)=>b.avg - a.avg);
    document.getElementById('best').textContent = `ğŸ† Best Student: ${averages[0].name} (${averages[0].avg})`;
    document.getElementById('worst').textContent = `ğŸ’” Worst Student: ${averages[averages.length-1].name} (${averages[averages.length-1].avg})`;
}
render();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
