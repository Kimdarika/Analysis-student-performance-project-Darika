<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teacher Insights ğŸŒˆ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/css/Teacher Insights.css">
    <link rel="stylesheet" href="/static/js/subject-analysis.js">
    <link rel="stylesheet" href="/static/css/navbar.css">
    <link rel="stylesheet" href="/static/js/navbar.js">
    <link rel="stylesheet" href="/static/css/footer.css">
</head>
<body class="bg-light">
  
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/dashboard">Student Analyzer</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/dashboard">ğŸ  Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="/student-profile">ğŸ‘©â€ğŸ“ Student Management</a></li>
                    <li class="nav-item"><a class="nav-link" href="/subject-analysis">ğŸ“˜ Subject Analysis</a></li>
                    <li class="nav-item"><a class="nav-link" href="/comparison">ğŸ“ˆ Comparison</a></li>
                    <li class="nav-item"><a class="nav-link" href="/prediction">ğŸ§® Prediction</a></li>
                    <li class="nav-item"><a class="nav-link" href="/reports">ğŸ“Š Reports</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/teacher-insights">ğŸ§‘â€ğŸ« Teacher Insights</a></li>
                    <li class="nav-item"><a class="nav-link" href="/trends">ğŸ—“ï¸ Trend</a></li>
                </ul>
            </div>
        </div>  
    </nav>

    <div class="container py-5">
        <div class="text-center mb-5">
            <h1 class="main-title display-4 mb-3">
                Student Progress & Scores ğŸš€
            </h1>
            <p class="subtitle lead mb-4">
                Click a month to input or view student scores.
            </p>
        </div>

        <div class="circle" id="circle">
            <div class="center-info" id="centerInfo">
                <h2 class="h4 mb-0">ğŸŒŸ 2025</h2>
            </div>
        </div>

        <div id="scoreSection" class="score-section d-none">
            <h2 id="scoreMonth" class="section-title text-center mb-4 display-5"></h2>
            
            <div class="btn-group-custom text-center mb-4">
                <button class="btn btn-primary" onclick="showInput('Quiz')">Quiz</button>
                <button class="btn btn-success" onclick="showInput('Midterm')">Midterm</button>
                <button class="btn btn-warning" onclick="showInput('Exam')">Exam</button>
                <button class="btn btn-danger" onclick="showInput('Final Exam')">Final Exam</button>
            </div>

            <!-- Input Section -->
            <div id="inputSection" class="input-section d-none">
                <h3 id="inputTitle" class="section-title text-center mb-4 h3"></h3>

                <div class="row">
                    <div class="col-md-6">
                        <h4 class="h5 fw-semibold mb-3 text-primary">Term 1</h4>
                        <div id="term1Inputs" class="row g-3"></div>
                    </div>

                    <div class="col-md-6">
                        <h4 class="h5 fw-semibold mb-3 text-primary">Term 2</h4>
                        <div id="term2Inputs" class="row g-3"></div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button class="btn btn-primary me-3 px-4 py-2" onclick="saveScores()">ğŸ’¾ Save</button>
                    <button class="btn btn-secondary px-4 py-2" onclick="clearInputs()">ğŸ§¹ Clear</button>
                </div>
            </div>

            <!-- Saved Section -->
            <div id="savedSection" class="d-none mt-5">
                <h3 class="section-title text-center mb-4 h3">ğŸ“Š Saved Scores</h3>
                <div id="savedTable" class="row g-4"></div>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="/trends" class="btn-compare">
                <svg class="me-2" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H21M10 12H21M10 18H21M3 6h.01M3 12h.01M3 18h.01"/>
                </svg>
                Compare Term
            </a>
        </div>
    </div>

    <footer>
        <p>Â© 2025 Student Analyzer. All Rights Reserved.</p>
        <p>
            <a href="/dashboard">Home</a> | 
            <a href="/reports">Reports</a> | 
            <a href="#">Contact</a>
        </p>
        <p class="social-icons">
            <a href="#" title="Facebook">ğŸ“˜</a>
            <a href="#" title="Twitter">ğŸ¦</a>
            <a href="#" title="LinkedIn">ğŸ’¼</a>
        </p>
        <p>Made with â¤ï¸ by the Student Analyzer Team</p>
    </footer>

    <script>
        // --- Setup and Variables ---
        const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
        const circle = document.getElementById("circle");
        const centerInfo = document.getElementById("centerInfo");
        const radius = 170, center = 215;

        const term1Subjects = ["BCU","English for IT","General English","Logic","PL","Design"];
        const term2Subjects = ["English for IT","General English","Algorithm","PL","Web Design"];

        let currentType = "", currentMonth = "";
        let allData = JSON.parse(localStorage.getItem('studentScores')) || {};

        // --- Create Circle of Months ---
        function initializeCircle() {
            months.forEach((month, i) => {
                const angle = (i / months.length) * 2 * Math.PI - Math.PI/2;
                const x = center + radius * Math.cos(angle) - 35;
                const y = center + radius * Math.sin(angle) - 35;

                const div = document.createElement("div");
                div.className = "month";
                div.textContent = month;
                div.style.left = `${x}px`;
                div.style.top = `${y}px`;

                // Generate different colors for each month
                const hue = (i * 30) % 360;
                div.style.background = `linear-gradient(135deg, hsl(${hue}, 70%, 60%), hsl(${(hue + 30) % 360}, 70%, 50%))`;

                div.addEventListener("mouseover", () => {
                    centerInfo.innerHTML = `<h2 class="h4 mb-0">${month}</h2>`;
                    centerInfo.style.background = div.style.background;
                });

                div.addEventListener("mouseout", () => {
                    centerInfo.innerHTML = `<h2 class="h4 mb-0">ğŸŒŸ 2025</h2>`;
                    centerInfo.style.background = "linear-gradient(135deg,#6366f1,#3b82f6)";
                });

                div.addEventListener("click", () => {
                    currentMonth = month;
                    document.getElementById("scoreSection").classList.remove("d-none");
                    document.getElementById("scoreMonth").innerText = `ğŸ“… Scores for ${month}`;
                    renderScores();
                    window.scrollTo({ top: document.getElementById("scoreSection").offsetTop - 100, behavior: "smooth" });
                });

                circle.appendChild(div);
            });
        }

        // --- Show Input Section ---
        function showInput(type) {
            currentType = type;
            document.getElementById("inputSection").classList.remove("d-none");
            document.getElementById("inputTitle").innerText = `âœ¨ ${type}`;

            const term1Div = document.getElementById("term1Inputs");
            const term2Div = document.getElementById("term2Inputs");
            term1Div.innerHTML = "";
            term2Div.innerHTML = "";

            const saved = allData[currentMonth]?.[type] || { term1: [], term2: [] };

            term1Subjects.forEach((sub, i) => {
                const inputGroup = document.createElement("div");
                inputGroup.className = "col-12 col-sm-6";
                
                const label = document.createElement("label");
                label.className = "form-label small text-muted mb-1";
                label.textContent = sub;
                
                const input = document.createElement("input");
                input.type = "number";
                input.min = 0; 
                input.max = 100;
                input.placeholder = "0-100";
                input.value = saved.term1[i] || '';
                input.className = "form-input-custom";
                
                inputGroup.appendChild(label);
                inputGroup.appendChild(input);
                term1Div.appendChild(inputGroup);
            });

            term2Subjects.forEach((sub, i) => {
                const inputGroup = document.createElement("div");
                inputGroup.className = "col-12 col-sm-6";
                
                const label = document.createElement("label");
                label.className = "form-label small text-muted mb-1";
                label.textContent = sub;
                
                const input = document.createElement("input");
                input.type = "number";
                input.min = 0; 
                input.max = 100;
                input.placeholder = "0-100";
                input.value = saved.term2[i] || '';
                input.className = "form-input-custom";
                
                inputGroup.appendChild(label);
                inputGroup.appendChild(input);
                term2Div.appendChild(inputGroup);
            });
        }

        // --- Save Scores ---
        function saveScores() {
            const term1Inputs = document.querySelectorAll("#term1Inputs input");
            const term2Inputs = document.querySelectorAll("#term2Inputs input");
            
            const term1 = Array.from(term1Inputs).map(input => {
                const value = parseInt(input.value);
                return isNaN(value) ? 0 : Math.min(100, Math.max(0, value));
            });
            
            const term2 = Array.from(term2Inputs).map(input => {
                const value = parseInt(input.value);
                return isNaN(value) ? 0 : Math.min(100, Math.max(0, value));
            });

            if (!allData[currentMonth]) allData[currentMonth] = {};
            allData[currentMonth][currentType] = { term1, term2 };

            localStorage.setItem('studentScores', JSON.stringify(allData));
            renderScores();
            
            // Show success message
            alert(`âœ… Saved ${currentType} scores for ${currentMonth}`);
        }

        // --- Clear Inputs ---
        function clearInputs() {
            document.querySelectorAll("#term1Inputs input, #term2Inputs input").forEach(input => {
                input.value = '';
            });
        }

        // --- Delete Scores ---
        function deleteScore(type) {
            if (confirm(`Are you sure you want to delete ${type} scores for ${currentMonth}?`)) {
                delete allData[currentMonth][type];
                
                // Remove month if no data left
                if (Object.keys(allData[currentMonth]).length === 0) {
                    delete allData[currentMonth];
                }
                
                localStorage.setItem('studentScores', JSON.stringify(allData));
                renderScores();
            }
        }

        // --- Render Saved Scores ---
        function renderScores() {
            const div = document.getElementById("savedTable");
            div.innerHTML = "";
            const data = allData[currentMonth] || {};

            if (Object.keys(data).length === 0) {
                document.getElementById("savedSection").classList.add("d-none");
                return;
            }
            document.getElementById("savedSection").classList.remove("d-none");

            for (const type in data) {
                const wrapper = document.createElement("div");
                wrapper.className = "col-12 col-md-6 col-lg-4";
                
                const card = document.createElement("div");
                card.className = "saved-item h-100";

                const header = document.createElement("div");
                header.className = "d-flex flex-column flex-sm-row justify-content-between align-items-start align-sm-center mb-3 gap-2";
                header.innerHTML = `<strong class="h6 text-primary mb-0">${type}</strong>`;

                const btnContainer = document.createElement("div");
                btnContainer.className = "d-flex gap-2";

                const editBtn = document.createElement("button");
                editBtn.className = "btn btn-warning btn-sm";
                editBtn.innerText = "Edit";
                editBtn.onclick = () => showInput(type);
                btnContainer.appendChild(editBtn);

                const delBtn = document.createElement("button");
                delBtn.className = "btn btn-danger btn-sm";
                delBtn.innerText = "Delete";
                delBtn.onclick = () => deleteScore(type);
                btnContainer.appendChild(delBtn);

                header.appendChild(btnContainer);
                card.appendChild(header);

                const table = document.createElement("table");
                table.className = "table table-sm table-borderless mb-0";

                let html = `<tr class="table-secondary"><th colspan="2" class="p-2">Term 1</th></tr>`;
                data[type].term1.forEach((score, i) => {
                    html += `<tr class="border-top"><td class="p-2">${term1Subjects[i]}</td><td class="p-2 text-center fw-medium">${score}</td></tr>`;
                });

                html += `<tr class="table-secondary"><th colspan="2" class="p-2">Term 2</th></tr>`;
                data[type].term2.forEach((score, i) => {
                    html += `<tr class="border-top"><td class="p-2">${term2Subjects[i]}</td><td class="p-2 text-center fw-medium">${score}</td></tr>`;
                });

                table.innerHTML = html;
                card.appendChild(table);
                wrapper.appendChild(card);
                div.appendChild(wrapper);
            }
        }

        // Initialize the circle when page loads
        document.addEventListener('DOMContentLoaded', initializeCircle);
    </script>
</body>
</html>